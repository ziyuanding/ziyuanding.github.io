<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>在WSL里使用Zerotier但SSH无法连接SSH2_MSG_KEX_ECDH_REPLY |</title><link rel=stylesheet href=https://ziyuanding.github.io/css/main.min.ae047bae72f7cfdc69dab3d0757b51bb79c4c867ba9a336983ec0c2a20c576eb.css integrity="sha256-rgR7rnL3z9xp2rPQdXtRu3nEyGe6mjNpg+wMKiDFdus="><link rel=stylesheet href=https://ziyuanding.github.io/semantic/dist/semantic.min.css><link rel=stylesheet href=https://ziyuanding.github.io/css/vendor/syntax.css><script src=https://code.jquery.com/jquery-2.2.2.min.js integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI=" crossorigin=anonymous></script><script src=/semantic/dist/semantic.min.js></script><script src=/js/vendor/fontawesome-all.js></script></head><body><header><nav><div class="ui grid container"><div class="computer only row"><div class="ui fluid large borderless blue menu"><div class="fitted item"><a href=/ style=text-decoration:none;color:#000><b>DING</b></a></div><div class=item><div class=item style=position:relative><div class="ui fluid transparent icon input"><input id=search-box type=text placeholder="Search posts...">
<i class="search icon"></i></div><ul id=search-results></ul></div></div><div class="right menu"><div class="ui item"><a href=/about style=text-decoration:none;color:#000><b>ABOUT</b></a></div><div class="ui item" style=padding-left:5px!important;padding-right:5px!important><a href=https://www.linkedin.com/in/ziyuan-ding-467314249/ target=_blank style=text-decoration:none;color:#000><i class="linkedin icon"></i></a></div><div class="ui item" style=padding-left:5px!important;padding-right:5px!important><a href=https://github.com/ziyuanding target=_blank style=text-decoration:none;color:#000><i class="github icon"></i></a></div></div></div></div><div class="tablet only row"><div class="ui fluid large borderless blue menu"><div class="fitted item"><a href=/ style=text-decoration:none;color:#000><b>DING</b></a></div><div class=item><div class=item style=position:relative><div class="ui fluid transparent icon input"><input id=search-box type=text placeholder="Search posts...">
<i class="search icon"></i></div><ul id=search-results></ul></div></div></div></div><div class="mobile only row"><div class="ui fluid borderless blue menu xo marginless"><div class="fitted item"><a href=/ style=text-decoration:none;color:#000><b>DING</b></a></div></div><div class="ui fluid borderless menu xo marginless center aligned"><div class=item><div class=item style=position:relative><div class="ui fluid transparent icon input"><input id=search-box type=text placeholder="Search posts...">
<i class="search icon"></i></div><ul id=search-results></ul></div></div></div></div></div></nav><style>#search-box{position:relative;z-index:10}#search-results{position:absolute;top:100%;left:0;width:100%;background:#fff;border:1px solid #ccc;border-top:none;max-height:250px;overflow-y:auto;box-shadow:0 2px 8px rgba(0,0,0,.1);z-index:9999;display:none;list-style:none;padding:0;margin:0}#search-results.show{display:block}#search-results li{padding:8px 12px;cursor:pointer}#search-results li:hover{background:#f0f0f0}</style><script src=https://cdn.jsdelivr.net/npm/fuse.js@6.6.2></script><script>async function searchPosts(e){const t=document.getElementById("search-results");if(!e.trim()){t.innerHTML="",t.classList.remove("show");return}const s=await fetch("/index.json"),o=await s.json(),i=new Fuse(o,{keys:["title","content"],threshold:.3}),n=i.search(e);t.innerHTML=n.map(e=>`<li><a href="${e.item.url}">${e.item.title}</a></li>`).join(""),n.length>0?t.classList.add("show"):t.classList.remove("show")}const searchBox=document.getElementById("search-box"),container=document.getElementById("search-results");searchBox.addEventListener("input",e=>{searchPosts(e.target.value)}),document.addEventListener("click",e=>{!e.target.closest("#search-box")&&!e.target.closest("#search-results")&&container.classList.remove("show")})</script></header><main><div class="ui grid container xo top padding"><div class="computer only row"><div class="eleven wide column"><div class="xo padding top bottom"><div class="ui mini horizontal divided link list"><div class="disabled item">Last edit: 2025-09-27</div><a class="item noelink noul" href=https://github.com//blob/master/posts/%e5%9c%a8WSL%e9%87%8c%e4%bd%bf%e7%94%a8Zerotier%e4%bd%86SSH%e6%97%a0%e6%b3%95%e8%bf%9e%e6%8e%a5.md target=_blank><span data-tooltip="Edit page in GitHub" data-variation=mini data-inverted><i class="fal fa-edit" data-fa-transform="grow-6 right-6"></i>
</span></a><a class="item noelink noul" href=https://github.com//issues/new target=_blank><span data-tooltip="Open GitHub Issue" data-variation=mini data-inverted><i class="fal fa-bug" data-fa-transform="grow-6 right-6"></i>
</span></a><a class="item noelink noul" href=https://github.com//issues/new target=_blank><span data-tooltip="Open Comments Issue in GitHub" data-variation=mini data-inverted><i class="fal fa-comments" data-fa-transform="grow-6 right-6"></i></span></a></div></div><article><h1 class="ui xo margin top without"><div class="ui medium">在WSL里使用Zerotier但SSH无法连接SSH2_MSG_KEX_ECDH_REPLY</div></h1><h1 id=bug-调查文档wsl-内-zerotier-ssh-连接卡住问题>Bug 调查文档：WSL 内 ZeroTier SSH 连接卡住问题</h1><h2 id=问题描述>问题描述</h2><p>在两台 Windows 机器 A 和 B 上，都安装了 WSL 和 ZeroTier(A在windows和wsl都安装了zerotier, B只在wsl里安装了zerotier) 的情况下，出现以下问题(均以ssh连接，地址使用zerotier的vpn ip)：</p><ul><li><strong>A 的 Windows → B 的 WSL</strong>：可以正常连接。</li><li><strong>A 的 WSL → B 的 WSL</strong>：SSH 连接卡住。</li><li><strong>A 的 WSL → 其他处于VPN的机器</strong>：ZeroTier 可以正常连接。</li></ul><p>具体表现为在 SSH 调试日志中卡在：</p><pre tabindex=0><code>debug1: expecting SSH2_MSG_KEX_ECDH_REPLY
</code></pre><h2 id=排查过程>排查过程</h2><ol><li><p><strong>分析 SSH debug 日志</strong></p><ul><li>客户端版本：OpenSSH_9.6p1</li><li>服务端版本：OpenSSH_8.2p1</li><li>握手开始正常，算法协商成功：<pre tabindex=0><code>kex: algorithm: curve25519-sha256
kex: host key algorithm: ssh-ed25519
</code></pre></li><li>卡在等待 <code>SSH2_MSG_KEX_ECDH_REPLY</code>，未收到服务端回应。</li></ul></li><li><p><strong>分析 ZeroTier 网络情况</strong></p><ul><li>A 的 WSL 可以通过 ZeroTier 连接其他机器，说明 WSL 内 ZeroTier 正常。</li><li>B 的 WSL 可以被 A 的 Windows 访问，说明 B 的 WSL ZeroTier 正常。</li><li>问题只发生在 <strong>A 的 WSL → B 的 WSL</strong>，提示可能是网络层（路由/NAT/MTU）问题。</li></ul></li><li><p><strong>推测原因</strong></p><ul><li>WSL2 使用 Hyper-V NAT，ZeroTier 虚拟网卡通过 NAT，可能导致大数据包（如 SSH 握手的 KEX ECDH 消息）丢失或被截断。</li><li>这与之前可以连通但后来不通的现象一致，属于网络条件微调导致的问题。</li></ul></li><li><p><strong>排查方法</strong></p><ul><li>在 A 和 B 的 WSL 内检查 ZeroTier 网卡：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip link show
</span></span></code></pre></div></li><li>测试对方的连通性（重要，实测，增大到1100时无法ping通）：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping -s <span class=m>900</span> &lt;对方 ZeroTier IP&gt;
</span></span></code></pre></div></li><li>观察 SSH 服务端日志：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo /usr/sbin/sshd -D -d
</span></span></code></pre></div>确认服务端是否收到 KEX 请求并尝试回应。</li></ul></li></ol><hr><h2 id=原因分析>原因分析</h2><ul><li>问题主要由 <strong>WSL2 + ZeroTier NAT 网络 MTU 不匹配</strong> 引起。</li><li>SSH 握手阶段发送的数据包过大，超过 WSL/ZeroTier 默认 MTU，导致包丢失，客户端卡在等待 ECDH_REPLY。</li><li>Windows 客户端能够连接成功是因为 Windows ZeroTier 使用宿主机网络栈，不受 WSL2 NAT 限制。</li></ul><hr><h2 id=解决方法>解决方法</h2><ol><li><p><strong>调整 MTU</strong></p><ul><li>在 A 和 B 的 WSL 内，找到 ZeroTier 虚拟网卡名称 <code>ztXXXX</code>：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip link show
</span></span></code></pre></div></li><li>修改 MTU 为较小值（测试可用值为 1000）：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ip link <span class=nb>set</span> dev ztXXXX mtu <span class=m>1000</span>
</span></span></code></pre></div></li><li>验证：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping -s <span class=m>900</span> &lt;对方 ZeroTier IP&gt;
</span></span><span class=line><span class=cl>ssh &lt;对方 ZeroTier IP&gt;
</span></span></code></pre></div></li></ul></li><li><p><strong>说明</strong></p><ul><li>调整 MTU 后 SSH 连接恢复正常。</li><li>过小 MTU 会增加分片开销，但对 SSH 小流量影响不大。</li><li>建议找到 <strong>最大稳定 MTU</strong>，可以用 <code>ping -s</code> 逐步测试包大小。</li></ul></li></ol><hr><h2 id=结论>结论</h2><ul><li>WSL2 内 ZeroTier 的 SSH 连接偶尔出现卡住，是 <strong>MTU 导致的大包丢失</strong>。</li><li>解决方案是 <strong>在双方 WSL 内减小 ZeroTier 虚拟网卡 MTU</strong>。</li><li>现象出现与之前能够连通但后来不通一致，属于网络微调引发的暂发性问题。</li></ul></article></div><div class="five wide column"><div class="ui attached segment"><table class="ui very basic small compact table"><tbody><tr><td><b>Collection:</b></td><td><a class=noelink href="/browse?q=&idx=diybiosphere&p=0&dFR%5Bcollection%5D%5B0%5D=" target=_blank></a></td></tr><tr class="top aligned"><td><b>Location:</b></td><td><span><a href="http://maps.google.com/?q=" target=_blank></a></span></td></tr></tbody></table></div><div class="ui bottom attached segment"></div></div></div><div class="tablet only row"><div class="nine wide column"><div class="xo padding top bottom"><div class="ui mini horizontal divided link list"><div class="disabled item">Last edit: 2025-09-27</div><a class="item noelink noul" href=https://github.com//blob/master/posts/%e5%9c%a8WSL%e9%87%8c%e4%bd%bf%e7%94%a8Zerotier%e4%bd%86SSH%e6%97%a0%e6%b3%95%e8%bf%9e%e6%8e%a5.md target=_blank><span data-tooltip="Edit page in GitHub" data-variation=mini data-inverted><i class="fal fa-edit" data-fa-transform="grow-6 right-6"></i>
</span></a><a class="item noelink noul" href=https://github.com//issues/new target=_blank><span data-tooltip="Open GitHub Issue" data-variation=mini data-inverted><i class="fal fa-bug" data-fa-transform="grow-6 right-6"></i>
</span></a><a class="item noelink noul" href=https://github.com//issues/new target=_blank><span data-tooltip="Open Comments Issue in GitHub" data-variation=mini data-inverted><i class="fal fa-comments" data-fa-transform="grow-6 right-6"></i></span></a></div></div><article><h1 class="ui xo margin top without"><div class="ui medium">在WSL里使用Zerotier但SSH无法连接SSH2_MSG_KEX_ECDH_REPLY</div></h1><h1 id=bug-调查文档wsl-内-zerotier-ssh-连接卡住问题>Bug 调查文档：WSL 内 ZeroTier SSH 连接卡住问题</h1><h2 id=问题描述>问题描述</h2><p>在两台 Windows 机器 A 和 B 上，都安装了 WSL 和 ZeroTier(A在windows和wsl都安装了zerotier, B只在wsl里安装了zerotier) 的情况下，出现以下问题(均以ssh连接，地址使用zerotier的vpn ip)：</p><ul><li><strong>A 的 Windows → B 的 WSL</strong>：可以正常连接。</li><li><strong>A 的 WSL → B 的 WSL</strong>：SSH 连接卡住。</li><li><strong>A 的 WSL → 其他处于VPN的机器</strong>：ZeroTier 可以正常连接。</li></ul><p>具体表现为在 SSH 调试日志中卡在：</p><pre tabindex=0><code>debug1: expecting SSH2_MSG_KEX_ECDH_REPLY
</code></pre><h2 id=排查过程>排查过程</h2><ol><li><p><strong>分析 SSH debug 日志</strong></p><ul><li>客户端版本：OpenSSH_9.6p1</li><li>服务端版本：OpenSSH_8.2p1</li><li>握手开始正常，算法协商成功：<pre tabindex=0><code>kex: algorithm: curve25519-sha256
kex: host key algorithm: ssh-ed25519
</code></pre></li><li>卡在等待 <code>SSH2_MSG_KEX_ECDH_REPLY</code>，未收到服务端回应。</li></ul></li><li><p><strong>分析 ZeroTier 网络情况</strong></p><ul><li>A 的 WSL 可以通过 ZeroTier 连接其他机器，说明 WSL 内 ZeroTier 正常。</li><li>B 的 WSL 可以被 A 的 Windows 访问，说明 B 的 WSL ZeroTier 正常。</li><li>问题只发生在 <strong>A 的 WSL → B 的 WSL</strong>，提示可能是网络层（路由/NAT/MTU）问题。</li></ul></li><li><p><strong>推测原因</strong></p><ul><li>WSL2 使用 Hyper-V NAT，ZeroTier 虚拟网卡通过 NAT，可能导致大数据包（如 SSH 握手的 KEX ECDH 消息）丢失或被截断。</li><li>这与之前可以连通但后来不通的现象一致，属于网络条件微调导致的问题。</li></ul></li><li><p><strong>排查方法</strong></p><ul><li>在 A 和 B 的 WSL 内检查 ZeroTier 网卡：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip link show
</span></span></code></pre></div></li><li>测试对方的连通性（重要，实测，增大到1100时无法ping通）：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping -s <span class=m>900</span> &lt;对方 ZeroTier IP&gt;
</span></span></code></pre></div></li><li>观察 SSH 服务端日志：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo /usr/sbin/sshd -D -d
</span></span></code></pre></div>确认服务端是否收到 KEX 请求并尝试回应。</li></ul></li></ol><hr><h2 id=原因分析>原因分析</h2><ul><li>问题主要由 <strong>WSL2 + ZeroTier NAT 网络 MTU 不匹配</strong> 引起。</li><li>SSH 握手阶段发送的数据包过大，超过 WSL/ZeroTier 默认 MTU，导致包丢失，客户端卡在等待 ECDH_REPLY。</li><li>Windows 客户端能够连接成功是因为 Windows ZeroTier 使用宿主机网络栈，不受 WSL2 NAT 限制。</li></ul><hr><h2 id=解决方法>解决方法</h2><ol><li><p><strong>调整 MTU</strong></p><ul><li>在 A 和 B 的 WSL 内，找到 ZeroTier 虚拟网卡名称 <code>ztXXXX</code>：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip link show
</span></span></code></pre></div></li><li>修改 MTU 为较小值（测试可用值为 1000）：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ip link <span class=nb>set</span> dev ztXXXX mtu <span class=m>1000</span>
</span></span></code></pre></div></li><li>验证：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping -s <span class=m>900</span> &lt;对方 ZeroTier IP&gt;
</span></span><span class=line><span class=cl>ssh &lt;对方 ZeroTier IP&gt;
</span></span></code></pre></div></li></ul></li><li><p><strong>说明</strong></p><ul><li>调整 MTU 后 SSH 连接恢复正常。</li><li>过小 MTU 会增加分片开销，但对 SSH 小流量影响不大。</li><li>建议找到 <strong>最大稳定 MTU</strong>，可以用 <code>ping -s</code> 逐步测试包大小。</li></ul></li></ol><hr><h2 id=结论>结论</h2><ul><li>WSL2 内 ZeroTier 的 SSH 连接偶尔出现卡住，是 <strong>MTU 导致的大包丢失</strong>。</li><li>解决方案是 <strong>在双方 WSL 内减小 ZeroTier 虚拟网卡 MTU</strong>。</li><li>现象出现与之前能够连通但后来不通一致，属于网络微调引发的暂发性问题。</li></ul></article></div><div class="seven wide column"><div class="ui attached segment"><table class="ui very basic small compact table"><tbody><tr><td><b>Collection:</b></td><td><a class=noelink href="/browse?q=&idx=diybiosphere&p=0&dFR%5Bcollection%5D%5B0%5D=" target=_blank></a></td></tr><tr class="top aligned"><td><b>Location:</b></td><td><span><a href="http://maps.google.com/?q=" target=_blank></a></span></td></tr></tbody></table></div><div class="ui bottom attached segment"></div></div></div><div class="mobile only row"><div class="sixteen wide column"><div class="ui attached segment"><table class="ui very basic small compact table"><tbody><tr><td><b>Collection:</b></td><td><a class=noelink href="/browse?q=&idx=diybiosphere&p=0&dFR%5Bcollection%5D%5B0%5D=" target=_blank></a></td></tr><tr class="top aligned"><td><b>Location:</b></td><td><span><a href="http://maps.google.com/?q=" target=_blank></a></span></td></tr></tbody></table></div><div class="ui bottom attached segment"></div></div><div class="sixteen wide column xo top padding fourfold"><div class="xo padding top bottom"><div class="ui mini horizontal divided link list"><div class="disabled item">Last edit: 2025-09-27</div><a class="item noelink noul" href=https://github.com//blob/master/posts/%e5%9c%a8WSL%e9%87%8c%e4%bd%bf%e7%94%a8Zerotier%e4%bd%86SSH%e6%97%a0%e6%b3%95%e8%bf%9e%e6%8e%a5.md target=_blank><span data-tooltip="Edit page in GitHub" data-variation=mini data-inverted><i class="fal fa-edit" data-fa-transform="grow-6 right-6"></i>
</span></a><a class="item noelink noul" href=https://github.com//issues/new target=_blank><span data-tooltip="Open GitHub Issue" data-variation=mini data-inverted><i class="fal fa-bug" data-fa-transform="grow-6 right-6"></i>
</span></a><a class="item noelink noul" href=https://github.com//issues/new target=_blank><span data-tooltip="Open Comments Issue in GitHub" data-variation=mini data-inverted><i class="fal fa-comments" data-fa-transform="grow-6 right-6"></i></span></a></div></div><article><h1 class="ui xo margin top without"><div class="ui medium">在WSL里使用Zerotier但SSH无法连接SSH2_MSG_KEX_ECDH_REPLY</div></h1><h1 id=bug-调查文档wsl-内-zerotier-ssh-连接卡住问题>Bug 调查文档：WSL 内 ZeroTier SSH 连接卡住问题</h1><h2 id=问题描述>问题描述</h2><p>在两台 Windows 机器 A 和 B 上，都安装了 WSL 和 ZeroTier(A在windows和wsl都安装了zerotier, B只在wsl里安装了zerotier) 的情况下，出现以下问题(均以ssh连接，地址使用zerotier的vpn ip)：</p><ul><li><strong>A 的 Windows → B 的 WSL</strong>：可以正常连接。</li><li><strong>A 的 WSL → B 的 WSL</strong>：SSH 连接卡住。</li><li><strong>A 的 WSL → 其他处于VPN的机器</strong>：ZeroTier 可以正常连接。</li></ul><p>具体表现为在 SSH 调试日志中卡在：</p><pre tabindex=0><code>debug1: expecting SSH2_MSG_KEX_ECDH_REPLY
</code></pre><h2 id=排查过程>排查过程</h2><ol><li><p><strong>分析 SSH debug 日志</strong></p><ul><li>客户端版本：OpenSSH_9.6p1</li><li>服务端版本：OpenSSH_8.2p1</li><li>握手开始正常，算法协商成功：<pre tabindex=0><code>kex: algorithm: curve25519-sha256
kex: host key algorithm: ssh-ed25519
</code></pre></li><li>卡在等待 <code>SSH2_MSG_KEX_ECDH_REPLY</code>，未收到服务端回应。</li></ul></li><li><p><strong>分析 ZeroTier 网络情况</strong></p><ul><li>A 的 WSL 可以通过 ZeroTier 连接其他机器，说明 WSL 内 ZeroTier 正常。</li><li>B 的 WSL 可以被 A 的 Windows 访问，说明 B 的 WSL ZeroTier 正常。</li><li>问题只发生在 <strong>A 的 WSL → B 的 WSL</strong>，提示可能是网络层（路由/NAT/MTU）问题。</li></ul></li><li><p><strong>推测原因</strong></p><ul><li>WSL2 使用 Hyper-V NAT，ZeroTier 虚拟网卡通过 NAT，可能导致大数据包（如 SSH 握手的 KEX ECDH 消息）丢失或被截断。</li><li>这与之前可以连通但后来不通的现象一致，属于网络条件微调导致的问题。</li></ul></li><li><p><strong>排查方法</strong></p><ul><li>在 A 和 B 的 WSL 内检查 ZeroTier 网卡：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip link show
</span></span></code></pre></div></li><li>测试对方的连通性（重要，实测，增大到1100时无法ping通）：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping -s <span class=m>900</span> &lt;对方 ZeroTier IP&gt;
</span></span></code></pre></div></li><li>观察 SSH 服务端日志：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo /usr/sbin/sshd -D -d
</span></span></code></pre></div>确认服务端是否收到 KEX 请求并尝试回应。</li></ul></li></ol><hr><h2 id=原因分析>原因分析</h2><ul><li>问题主要由 <strong>WSL2 + ZeroTier NAT 网络 MTU 不匹配</strong> 引起。</li><li>SSH 握手阶段发送的数据包过大，超过 WSL/ZeroTier 默认 MTU，导致包丢失，客户端卡在等待 ECDH_REPLY。</li><li>Windows 客户端能够连接成功是因为 Windows ZeroTier 使用宿主机网络栈，不受 WSL2 NAT 限制。</li></ul><hr><h2 id=解决方法>解决方法</h2><ol><li><p><strong>调整 MTU</strong></p><ul><li>在 A 和 B 的 WSL 内，找到 ZeroTier 虚拟网卡名称 <code>ztXXXX</code>：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip link show
</span></span></code></pre></div></li><li>修改 MTU 为较小值（测试可用值为 1000）：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ip link <span class=nb>set</span> dev ztXXXX mtu <span class=m>1000</span>
</span></span></code></pre></div></li><li>验证：<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping -s <span class=m>900</span> &lt;对方 ZeroTier IP&gt;
</span></span><span class=line><span class=cl>ssh &lt;对方 ZeroTier IP&gt;
</span></span></code></pre></div></li></ul></li><li><p><strong>说明</strong></p><ul><li>调整 MTU 后 SSH 连接恢复正常。</li><li>过小 MTU 会增加分片开销，但对 SSH 小流量影响不大。</li><li>建议找到 <strong>最大稳定 MTU</strong>，可以用 <code>ping -s</code> 逐步测试包大小。</li></ul></li></ol><hr><h2 id=结论>结论</h2><ul><li>WSL2 内 ZeroTier 的 SSH 连接偶尔出现卡住，是 <strong>MTU 导致的大包丢失</strong>。</li><li>解决方案是 <strong>在双方 WSL 内减小 ZeroTier 虚拟网卡 MTU</strong>。</li><li>现象出现与之前能够连通但后来不通一致，属于网络微调引发的暂发性问题。</li></ul></article></div></div></div><div class="ui grid container xo top padding"><section class="xo margin top fourfold"><h3 class="ui horizontal divider header"><i class="far fa-comments"></i> Comments</h3><a target=_blank href=https://github.com//issues/new><div class="ui basic submit mini button"><i class="fal fa-comment"></i> Open Comments Issue in GitHub</div></a></section></div><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js></script><script type=text/javascript>function loadComments(e){for(var n,s,o,i,a,r,c,t=0;t<e.length;t++)s=e[t].user.login,o="https://www.github.com/"+e[t].user.login,c=e[t].user.type,n="https://github.com//issues/#issuecomment-"+e[t].url.substring(e[t].url.lastIndexOf("/")+1),i=e[t].body_html,a=e[t].user.avatar_url,r=Date.parse(e[t].created_at).toString("yyyy-MM-dd HH:mm"),$("#comments").append(`<div class='comment'><a class='avatar'><img src="`+a+`"></a><div class='content'><a class='author' target='_blank' href="`+o+'">'+s+"</a><div class='metadata'><div class='date'>"+r+"</div></div><div class='text'>"+i+`</div></div><div class='actions'><a target='_blank' href="`+n+`" class='reply'><i class='far fa-reply'></i> Reply</a><a target='_blank' href="`+n+`" class='reply'><i class='far fa-smile'></i> React</a></div></div></div>`)}</script></main><footer><footer class="xo top margin sixfold"><div class="ui container center aligned grid xo top bottom padding"><div class=row><div class="sixteen wide column"><div class="ui small horizontal divided link list"><a class=item href=https://github.com/DIYbiosphere/sphere>This site's theme is powered by DIYbiosphere under CC0.</a></div></div></div></div></footer></footer></body></html>